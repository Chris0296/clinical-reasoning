{
  "resourceType": "PlanDefinition",
  "id": "plandefinition-RuleFilters-1.0.0",
  "meta": {
      "profile": [
        "http://hl7.org/fhir/us/ecr/StructureDefinition/plandefinition-ersd-instance"
      ]
    },
  "extension": [
      {
          "url": "http://jamesagnew.github.io/hapi-fhir/StructureDefinition/ext-subscription-email-body",
          "valueString": "eRSD Update - April 23rd 2020\n \nA new version of the electronic Reporting and Surveillance Distribution (eRSD) has been uploaded to the eRSD service and is now available for implementation. The eRSD distribution includes Reportable Condition Trigger Codes (RCTC) and other reporting guidance in support of electronic Case Reporting (eCR).\n \n***This is an emergency distribution and should be immediately implemented to address critical public health surveillance needs.*** \n \nThis version:\nThis release includes code updates for the existing conditions and adds codes for VPDs, non-fatal opioid overdose, SARS, MERS, and COVID-19.\t\t\n \nThis distribution should be implemented as soon as possible.\n \nQuestions can be directed to eCR-Info@aimsplatform.org.\n"
      }
  ],
  "url": "http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-RuleFilters-1.0.0",
  "version": "0.1",
  "name": "PlanDefinition_RuleFilter_Instance",
  "title": "PlanDefinition RuleFilter Instance",
  "type": {
      "coding": [
          {
              "system": "http://terminology.hl7.org/CodeSystem/plan-definition-type",
              "code": "eca-rule",
              "display": "ECA Rule"
          }
      ]
  },
  "status": "active",
  "date": "2020-04-23T17:14:05-04:00",
  "effectivePeriod": {
      "start": "2020-06-01"
  },
  "relatedArtifact": [
      {
          "type": "depends-on",
          "label": "RCTC Value Set Library of Trigger Codes",
          "resource": "http://hl7.org/fhir/us/ecr/Library/rctc"
      }
  ],
  "library": [
    "http://test.canonical/Library/RuleFilters|1.0.0"
  ],
  "action": [
      {
          "id": "match-trigger",
          "description": "This action represents the matching of a trigger code to one of the values in the eRSD value sets.",
          "textEquivalent": "Match of a code to one of the values in the eRSD value sets.",
          "trigger": [
              {
                  "type": "data-changed",
                  "data": [
                      {
                          "type": "CodeableConcept",
                          "codeFilter": [
                              {
                                  "path": "Condition.code",
                                  "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-dxtc-example"
                              }
                          ]
                      }
                  ]
              },
              {
                  "type": "data-changed",
                  "data": [
                      {
                          "type": "CodeableConcept",
                          "codeFilter": [
                              {
                                  "path": "Immunization.vaccineCode",
                                  "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-iztc-example"
                              }
                          ]
                      }
                  ]
              },
              {
                  "type": "data-changed",
                  "data": [
                      {
                          "type": "CodeableConcept",
                          "codeFilter": [
                              {
                                  "path": "ServiceRequest.code",
                                  "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-lotc-example"
                              }
                          ]
                      }
                  ]
              },
              {
                  "type": "data-changed",
                  "data": [
                      {
                          "type": "CodeableConcept",
                          "codeFilter": [
                              {
                                  "path": "Observation.code",
                                  "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-lrtc-example"
                              }
                          ]
                      }
                  ]
              },
              {
                  "type": "data-changed",
                  "data": [
                      {
                          "type": "CodeableConcept",
                          "codeFilter": [
                              {
                                  "path": "MedicationAdministration.medicationCodeableConcept",
                                  "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example"
                              }
                          ]
                      }
                  ]
              },
              {
                  "type": "data-changed",
                  "data": [
                      {
                          "type": "CodeableConcept",
                          "codeFilter": [
                              {
                                  "path": "Observation.code",
                                  "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-ostc-example"
                              }
                          ]
                      }
                  ]
              }
          ],
          "condition": [
            {
              "kind": "applicability",
              "expression": {
                "description": "Filterable",
                "language": "text/cql.name",
                "expression": "IsReportable"
              }
            }
          ],
          "definitionCanonical": "ActivityDefinition/activitydefinition-rulefilter-report"
        },
      {
          "id": "create-eicr",
          "description": "This action represents the initial creation of the eICR.",
          "textEquivalent": "eICR construction delay (x hours) - time after trigger event before an eICR should be created.",
          "code": [
              {
                "coding": [
                  {
                      "code": "create-eicr",
                      "system": "http://aphl.org/fhir/ecr/CodeSystem/executable-task-types",
                      "display": "eICR construction delay (x hours) - time after trigger event before an eICR should be created."
                  }
                ]
              }
            ],
          "relatedAction": [
              {
                  "actionId": "match-trigger",
                  "relationship": "after",
                  "offsetDuration": {
                      "value": 3,
                      "unit": "h"
                  }
              }
          ],
          "definitionCanonical": "ActivityDefinition/activitydefinition-create-eicr"
      },
      {
          "id": "periodic-update-eicr",
          "description": "This action represents the periodic update of the eICR.",
          "textEquivalent": "eICR periodic update (y hours) - the time after an initial eICR creation to send a new eICR as an update during long encounters.",
          "code": [
              {
                "coding": [
                  {
                      "code": "periodic-update-eicr",
                      "system": "http://aphl.org/fhir/ecr/CodeSystem/executable-task-types",
                      "display": "eICR periodic update (y hours) – the time after an initial eICR transmission to send a new eICR as an update during long encounters."
                  }
                ]
              }
            ],
          "trigger": [
              {
                  "type": "periodic",
                  "timingTiming": {
                      "repeat": {
                          "frequency": 1,
                          "period": 24,
                          "periodUnit": "h"
                      }
                  }
              }
          ],
          "condition": [
              {
                  "kind": "start",
                  "expression": {
                      "description": "Encounter is active.",
                      "language": "text/fhirpath",
                      "expression": "Encounter.period.start.exists() and Encounter.period.end.empty()"
                  }
              },
              {
                  "kind": "stop",
                  "expression": {
                      "description": "Encounter is closed.",
                      "language": "text/fhirpath",
                      "expression": "Encounter.period.end.exists()"
                  }
              }
          ],
          "relatedAction": [
              {
                  "actionId": "create-eicr",
                  "relationship": "after",
                  "offsetDuration": {
                      "value": 24,
                      "unit": "h"
                  }
              }
          ],
          "definitionCanonical": "ActivityDefinition/activitydefinition-periodic-update-eicr"
      },
      {
          "id": "close-out-eicr",
          "description": "This action represents the close out of an eICR encounter.",
          "textEquivalent": "eICR encounter close out (z hours) - the time after the end of the encounter to create the final eICR when there have been one or more trigger events.",
          "code": [
              {
                "coding": [
                  {
                      "code": "close-out-eicr",
                      "system": "http://aphl.org/fhir/ecr/CodeSystem/executable-task-types",
                      "display": "eICR encounter close out (z hours) – the time after the end of the encounter to create the final eICR when there have been one or more trigger events."
                  }
                ]
              }
            ],
          "trigger": [
              {
                  "type": "data-added",
                  "data": [
                      {
                          "type": "Encounter",
                          "profile": [
                              "http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-encounter"
                          ],
                          "dateFilter": [
                              {
                                  "path": "period.end"
                              }
                          ]
                      }
                  ]
              }
          ],
          "relatedAction": [
            {
              "actionId": "create-eicr",
              "relationship": "after",
              "offsetDuration": {
                "value": 90,
                "unit": "s"
              }
            }
          ],
          "definitionCanonical": "ActivityDefinition/activitydefinition-close-out-eicr"
      },
      {
          "id": "validate-eicr",
          "description": "This action represents the validation of an eICR.",
          "textEquivalent": "Validate eICR.",
          "code": [
              {
                "coding": [
                  {
                      "code": "validate-eicr",
                      "system": "http://aphl.org/fhir/ecr/CodeSystem/executable-task-types",
                      "display": "Validate eICR."
                  }
                ]
              }
            ],
          "trigger": [
              {
                  "type": "data-changed",
                  "name": "eicr-created",
                  "data": [
                      {
                          "type": "Composition",
                          "profile": [
                              "http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-composition"
                          ]
                      }
                  ]
              }
          ],
          "definitionCanonical": "ActivityDefinition/activitydefinition-validate-eicr"
      },
      {
          "id": "route-and-send-eicr",
          "description": "This action represents the routing and sending of an eICR.",
          "textEquivalent": "Route and send eICR",
          "code": [
              {
                "coding": [
                  {
                      "code": "route-and-send-eicr",
                      "system": "http://aphl.org/fhir/ecr/CodeSystem/executable-task-types-types",
                      "display": "Route and send eICR"
                  }
                ]
              }
            ],
          "relatedAction": [
              {
                  "actionId": "validate-eicr",
                  "relationship": "after"
              }
          ],
          "definitionCanonical": "ActivityDefinition/activitydefinition-route-and-send-eicr"
      }
  ]
}