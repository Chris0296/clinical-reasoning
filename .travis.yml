language: java
jdk: openjdk11
os: linux
dist: xenial
cache:
  timeout: 180
  directories:
  - "$HOME/.m2/repository"
install:
- mvn install -U -DskipTests=true -Dmaven.javadoc.skip=true -B -V
script:
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then mvn test -B -P release; fi
- if ! [[ "$TRAVIS_BRANCH" =~ master* ]]; then mvn test -B; fi
before_deploy:
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then echo $GPG_SECRET_KEYS | base64 --decode
  | $GPG_EXECUTABLE --import; fi
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then echo $GPG_OWNERTRUST | base64 --decode
  | $GPG_EXECUTABLE --import-ownertrust; fi
deploy:
- provider: script
  script: cp .travis.settings.xml $HOME/.m2/settings.xml && mvn deploy -DskipTests=true
  cleanup: false
  skip_cleanup: true
  on:
    branch: develop
- provider: script
  script: cp .travis.settings.xml $HOME/.m2/settings.xml && mvn deploy -P release
    -DskipTests=true
  cleanup: false
  skip_cleanup: true
  on:
    branch: master
before_cache:
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql/cli
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql/rest
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql/service
notifications:
  slack:
    rooms:
      secure: NS0wLbgDgtmShBFpSYzi67ef/6lhFBiCw9nkJCHT+a47FXQb1l+dUk4EAd9SjpWHBO1YcL5yZ95+QaweVhKyEjAxlxJVNpAh3Yg9zskjrzfGqK5Uwz+HhcctyuzJ+GVhn4Ri+1NSqKp4uL2UvmqtrTCdwZ8r7z6s8Q7Q+Mh+JdTNpujCT3iziOL2zK20fay5kS/DX3CiA8wUKYxqWxLMlhv+L9/ZyFztuVWYJO1+J1tC27twlzVAwL/tP38m/X7WB7ITp9koWX+8+2R7mgTnCGNJrSMZH4+iNCnmcRr5m5LGbvaaK59JnhylkAN5X3+ojMN450AA1nHL+hEYfxhARoy4wQ6u9g/3qkbRSXFvCjWvSUJnVAkCNAGPR68Q415mkdnS9UJ1PdRa0HPGjuxGv3CIWmJzAuXo2TNj9NakVKyOh/TZh8OrYQifhF4sLx9DTntHaxJtfB/SWZ9Vvj92YPRC6l3YCtLrFdxisEIa4N+EYxZXiTE1bCUpoCld7h7U5q1vmBKafv8z0HhCFrR5QSXPDby3fuU7oIKX3drn3HVnyBrbkQFapYXOKHD/O71DHitgFYSMp3zpRar2niMiQm6AJVry1oAxlo/x99UiZrFRrU+PuSLT9vzasfTf88HuYihcfDBF0HMOUmXRVR/ORdqS8AHn0r/9FprqDDTRK9Q=
