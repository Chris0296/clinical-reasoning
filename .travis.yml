language: java
jdk: openjdk11
os: linux
dist: xenial
cache:
  timeout: 180
  directories:
  - "$HOME/.m2/repository"
install:
- mvn install -U -DskipTests=true -Dmaven.javadoc.skip=true -B -V
script:
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then mvn test -B -P release; fi
- if ! [[ "$TRAVIS_BRANCH" =~ master* ]]; then mvn test -B; fi
before_deploy:
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then echo $GPG_SECRET_KEYS | base64 --decode
  | $GPG_EXECUTABLE --import; fi
- if [[ "$TRAVIS_BRANCH" =~ master* ]]; then echo $GPG_OWNERTRUST | base64 --decode
  | $GPG_EXECUTABLE --import-ownertrust; fi
deploy:
- provider: script
  script: cp .travis.settings.xml $HOME/.m2/settings.xml && mvn deploy -DskipTests=true
  cleanup: false
  skip_cleanup: true
  on:
    branch: develop
- provider: script
  script: cp .travis.settings.xml $HOME/.m2/settings.xml && mvn deploy -P release
    -DskipTests=true
  cleanup: false
  skip_cleanup: true
  on:
    branch: master
before_cache:
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql/cli
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql/rest
- rm -rf $HOME/.m2/repository/org/opencds/cqf/cql/service
notifications:
  slack:
    rooms:
      secure: g1twiv/3LU7slzQMWjmyHYS9uz3WUhpaF1tPl7fCTRraVtPkjbEFJBpfXlCJYDXE5YqWzrVwQqSKctyb3vbAPO9bOYBsjXzGCSP9BVq8FcYWkRTknguX+52xJ7tFJq/ex+/VTtvxTvvpuNMaBcRnlOcJ5TpxRg3q0gomxflWfLlU1A/OcP/Au+9PZrYhDpnOxRCu4RbBo6o7mw7CAwE8f4cBrfilLl3F+BmQmQUGkxS9hHiHWnbL+KA6CBZvoCDaisr9kBnGD+7xNxNx49foHeTcbumflhetGuTn7MbC7TGeaaYFo0T5A18RKLUo9VGTZsSghf+/J5QCEffzZM0u1cuJmg2pY7GM9Hkvf3ZjXQZCDkJrvuOuPD5+jMG/vsiA+nuUka7vMFdMNaM5Pmk3maJS2ltybxwQVDydEq1UWJEo6TO9GWpBlxjgzyVnFNGhFEEBpyeTyWLkiq3PHQd1c44KuyasQ8fsiXiXFSUSILbJtamoFbGtESesFw1dy1lm3IqN9zQnXz9vp56J3liwG/5bjVQ08ucOXWvrsMoDK2Q1xBizvnSG9eXN/G9mWiUUw8w5SeHwcRkgwhewEcqE6d5ixBap8IDRX+fxzb5yxS6XnTHhbgAbenIggznytYFr212Cwg/2TSnFGQbFRjD1K8RPvYKMfW93ukbZusej/+g=
